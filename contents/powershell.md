# powershell
## powershellとは???

`powershell`はwindowsにおける標準のシェルです．

以前のwindowsのシェルはコマンドプロンプト（`cmd`）でしたが，どうしても必要な場合以外は使う必要はありません．

このエントリでは`powershell`の使い方一般を説明します．

## powershellを呼び出す
以下の中からお好きな方法でどうぞ．
- ファイル名を指定して実行（ショートカットキー`Win + R`），`powershell`を入力，`Enter`で決定
- エクスプローラ上で`Shift + 右クリック`，`Powershell ウィンドウをここで開く`を選択
- ショートカットキー`Win + X`, 開いたコンテキストメニューから`Windows PowerShell`を選択
- スタートボタン（`Win`）を押す，`powershell`を探して（or 検索して）実行

ちなみに`powershell`を管理者として実行したい場合は，以下のお好きな方法で．
- ファイル名を指定して実行（ショートカットキー`Win + R`），`powershell`を入力，`Ctrl + Shift + Enter`で決定
- ショートカットキー`Win + X`, 開いたコンテキストメニューから`Windows PowerShell (管理者)`を選択

最近なら`Windows Terminal`経由で`powershell`を実行するほうが使いやすいんじゃないかな．色も見やすいし．

## powershellを操作する
基本はLinuxのシェル (`bash`) と同じです．まずは`ls`や`cd`，`pwd`などのコマンドを打ってみましょう．ちなみに`ssh`も使えます．

```
PS C:\> ls


    ディレクトリ: C:\


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       2017/05/23     15:41                Intel
d-----       2020/05/18     16:24                Program Files
d-r---       2020/04/22     13:25                Program Files (x86)
d-r---       2019/07/13     21:10                Users
d-----       2020/06/11     19:28                Windows


PS C:\> cd .\Users\
PS C:\Users> pwd

Path
----
C:\Users


PS C:\Users>
```

他にもかなりいろいろなことができます．ファイルを読んだりはもちろん，`for`文とかも書けます．気になったらいろいろ調べてみるとよいでしょう．

## スクリプトを使う
スクリプトは複数の手続きを一つにまとめるために作成します．例えば，複数のプログラムをマルチプロセス的に起動させる場合や，複数のディレクトリを一括して消す場合などでしょう．手作業が面倒になったらスクリプトを書くのです．

`powershell`のスクリプトファイルの拡張子は`.ps1`です．

### 作成する方法
まずテキストエディタなどで拡張子が`.ps1`のファイルを作成します．その後，作成したファイルに所望のコマンドを記入すれば作成できます．

具体的には，まず適当な場所にスクリプトのファイルを作成します．名前はなんでもいいです．面倒なら`Run.ps1`とかにしておけば．その後作成したファイルをテキストエディタで開き，以下のようなスクリプトを記入します．

```
Write-Host "Hello World!!!"

$x = 10
$y = 2.3
Write-Host "x + y = $( $x + $y )"

for ($i = 0; $i -lt 5; $i++) {
    Write-Host "$i th roop, now -> $( Get-Date -Format "yyyy/MM/dd HH:mm:ss.fff" )"
    Start-Sleep 1
}
```

作成したスクリプトを実行する方法は次のセクションで説明します．

### 実行する方法

実行するスクリプトの名前が`Run.ps1`の時，コンソールに次のように入力する．

```
PS C:\> Run.ps1

# あるいは...
PS C:\> powershell .\Run.ps1
```

ここで注意として，`powershell`は良くも悪くも何でもできてしまうので，設定（実行ポリシー）を変えないとスクリプトは実行できないようになっています．そのためスクリプト実行のためには実行ポリシーを変更する必要があります．ちなみに実行ポリシーは一度変更すれば，今後そのマシンで実行ポリシーを意識することはありません．

実行ポリシーを変更するためにはまず，`powershell`を**管理者として実行**します．その後以下のコマンドを入力するだけです．
```
PS C:\> Set-ExecutionPolicy RemoteSigned

# 表示されるメッセージを読んで，`Y`を入力．
```

正しく実行ポリシーが変更できたかどうかは，以下のコマンドで確認できます．
```
PS C:\> Get-ExecutionPolicy
```

### インターネット上からダウンロードしたスクリプトを実行する

インターネットからダウンロードしたスクリプトは，右クリックしてプロパティを開くと，以下のようなメッセージが書いてあることがあります．

```
このファイルは他のコンピュータから取得したものです。このコンピュータを保護するため、...（後略）
```

このままでは実行できません．そこで以下のコマンドで実行できるように変更できます．
```
PS C:\> Unblock-File .\Script.ps1
```

## ほか
`powershell`は`.Net`のモジュールを使用できます．要するに`C#`のクラスの多くがそのまま使えます．超便利．

プログラミング言語とシェルのスクリプトの使い分けを問われることがよくあります．これはなかなか難しい質問です．やろうと思えばシェルのスクリプトでプログラミング言語でできることは全てできるし，また逆も然りです．プログラミング言語が作成するプログラムはあくまでコマンドの一つだと考えると，使い分けの基準が見えてくるのかもしれませんね．
